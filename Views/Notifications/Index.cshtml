@model IEnumerable<Whisper.Models.Notifications>

<div class="container mt-3" style="max-height: 90vh; overflow-y: auto;">


    @if (!Model.Any())
    {
        <div class="alert alert-info">Non ci sono notifiche da mostrare.</div>
    }
    else
    {
        foreach (var notification in Model)
        {
            <div class="alert alert-secondary">
                @if (notification.PostID.HasValue && !notification.LikeID.HasValue && !notification.CommentID.HasValue)
                {
                    <p>
                        <a href="@Url.Action("Details", "Users", new { id = notification.TriggeredByUserID })"
                           class="text-decoration-none fw-bold color-wine">
                            @notification.Users.Username
                        </a> ha pubblicato un post
                    </p>
                    <p>
                        <a href="@Url.Action("Index", "Posts")#post-@notification.PostID"
                           class="btn btn-sm btn-login text-white"
                           onclick="markAsRead(@notification.NotificationID, this.href); return false;">
                            Vai al post di @notification.Users.Username
                        </a>
                    </p>
                }
                else if (notification.CommentID.HasValue)
                {
                    <p>
                        <a href="@Url.Action("Details", "Users", new { id = notification.TriggeredByUserID })"
                           class="text-decoration-none fw-bold color-wine">
                            @notification.Users.Username
                        </a> ha commentato il tuo post
                    </p>
                    <p>
                        <a href="@Url.Action("Index", "Posts")#post-@notification.PostID" 
                           class="btn btn-sm btn-login text-white"
                           onclick="markAsRead(@notification.NotificationID, this.href); return false;">
                            Vai al mio post
                        </a>
                    </p>
                }
                else if (notification.LikeID.HasValue)
                {
                    <p>
                        A
                        <a href="@Url.Action("Details", "Users", new { id = notification.TriggeredByUserID })"
                           class="text-decoration-none fw-bold color-wine">
                            @notification.Users.Username
                        </a> piace il tuo post
                    </p>
                    <p>
                        <a href="@Url.Action("Index", "Posts")#post-@notification.PostID" 
                           class="btn btn-sm btn-login text-white"
                           onclick="markAsRead(@notification.NotificationID, this.href); return false;">
                            Vai al mio post
                        </a>
                    </p>
                }
                <p><strong>Data:</strong> @notification.NotificationDate.Value.ToString("dd/MM/yyyy HH:mm")</p>
                <p>
                    <strong>Stato:</strong>
                    @(notification.ReadStatus.HasValue && notification.ReadStatus.Value ? "Letta ✔" : "Non Letta ❌")
                </p>
            </div>
        }
    }
</div>

<script>
    function markAsRead(notificationId, redirectTo) {
        $.post('@Url.Action("MarkNotificationAsRead")', { notificationId: notificationId }, function(response) {
            if (response.success) {
                window.location.href = redirectTo;
            } else {
                alert(response.message);
            }
        });
    }
</script>
